<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Manage Profiles - Back2Roots</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: #f5f7fa;
      color: #333;
    }
    h1 {
      color: #27ae60;
    }
    input[type="text"], input[type="email"], select {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    button {
      background: #27ae60;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1rem;
      margin-right: 10px;
    }
    button:hover {
      background: #1e8449;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      user-select: none;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #27ae60;
      color: white;
      cursor: pointer;
      user-select: none;
    }
    tr.editing td {
      background: #e8f5e9;
    }
    #searchInput {
      width: 300px;
      padding: 8px 10px;
      margin-bottom: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0; top: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 12px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .modal-buttons {
      text-align: right;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Manage Profiles</h1>

  <input type="text" id="searchInput" placeholder="Search profiles..." aria-label="Search profiles" />

  <table id="profilesTable" aria-label="List of profiles">
    <thead>
      <tr>
        <th data-key="id">ID ▲▼</th>
        <th data-key="name">Name ▲▼</th>
        <th data-key="role">Role ▲▼</th>
        <th data-key="email">Email ▲▼</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Profiles inserted here -->
    </tbody>
  </table>

  <h2>Add New Profile</h2>
  <form id="profileForm" aria-label="Add new profile form">
    <label for="name">Name</label>
    <input type="text" id="name" required />

    <label for="role">Role</label>
    <select id="role" required>
      <option value="">Select role</option>
      <option value="Student">Student</option>
      <option value="Alumni">Alumni</option>
      <option value="Admin">Admin</option>
    </select>

    <label for="email">Email</label>
    <input type="email" id="email" required />

    <button type="submit">Add Profile</button>
  </form>

  <!-- Delete confirmation modal -->
  <div id="deleteModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
    <div class="modal-content">
      <h3 id="modalTitle">Confirm Delete</h3>
      <p id="modalDesc">Are you sure you want to delete this profile?</p>
      <div class="modal-buttons">
        <button id="confirmDeleteBtn">Yes, Delete</button>
        <button id="cancelDeleteBtn">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    let profiles = [
      { id: 1, name: "Alice Johnson", role: "Admin", email: "alice@example.com" },
      { id: 2, name: "Bob Smith", role: "Student", email: "bob@example.com" },
      { id: 3, name: "Carol Lee", role: "Alumni", email: "carol@example.com" }
    ];

    const profilesTableBody = document.querySelector("#profilesTable tbody");
    const profileForm = document.getElementById("profileForm");
    const searchInput = document.getElementById("searchInput");
    const deleteModal = document.getElementById("deleteModal");
    const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
    const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");

    let deleteId = null;
    let sortKey = null;
    let sortAsc = true;

    function renderProfiles() {
      let filtered = profiles.filter(p => {
        const q = searchInput.value.toLowerCase();
        return (
          p.name.toLowerCase().includes(q) ||
          p.role.toLowerCase().includes(q) ||
          p.email.toLowerCase().includes(q) ||
          p.id.toString().includes(q)
        );
      });

      if (sortKey) {
        filtered.sort((a,b) => {
          if (a[sortKey] < b[sortKey]) return sortAsc ? -1 : 1;
          if (a[sortKey] > b[sortKey]) return sortAsc ? 1 : -1;
          return 0;
        });
      }

      profilesTableBody.innerHTML = "";
      filtered.forEach(profile => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${profile.id}</td>
          <td class="editable" data-key="name">${escapeHtml(profile.name)}</td>
          <td class="editable" data-key="role">${escapeHtml(profile.role)}</td>
          <td class="editable" data-key="email">${escapeHtml(profile.email)}</td>
          <td>
            <button class="editBtn" aria-label="Edit profile ${profile.name}">Edit</button>
            <button class="deleteBtn" aria-label="Delete profile ${profile.name}">Delete</button>
          </td>
        `;
        profilesTableBody.appendChild(tr);
      });
      attachRowEventListeners();
    }

    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, m => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      })[m]);
    }

    function attachRowEventListeners() {
      document.querySelectorAll(".deleteBtn").forEach(btn => {
        btn.onclick = e => {
          const row = e.target.closest("tr");
          const id = parseInt(row.children[0].textContent);
          deleteId = id;
          deleteModal.style.display = "flex";
          deleteModal.focus();
        };
      });

      document.querySelectorAll(".editBtn").forEach(btn => {
        btn.onclick = e => {
          const row = e.target.closest("tr");
          if (row.classList.contains("editing")) return; // already editing
          row.classList.add("editing");
          for (let i=1; i<=3; i++) {
            const cell = row.children[i];
            const key = cell.getAttribute("data-key");
            const val = cell.textContent;
            if (key === "role") {
              const select = document.createElement("select");
              ["Student","Alumni","Admin"].forEach(opt => {
                const option = document.createElement("option");
                option.value = opt;
                option.textContent = opt;
                if (opt === val) option.selected = true;
                select.appendChild(option);
              });
              cell.textContent = "";
              cell.appendChild(select);
            } else {
              const input = document.createElement("input");
              input.type = key === "email" ? "email" : "text";
              input.value = val;
              cell.textContent = "";
              cell.appendChild(input);
            }
          }
          // Change buttons
          const actionCell = row.children[4];
          actionCell.innerHTML = `
            <button class="saveBtn" aria-label="Save profile changes">Save</button>
            <button class="cancelBtn" aria-label="Cancel editing">Cancel</button>
          `;
          actionCell.querySelector(".saveBtn").onclick = () => saveEdit(row);
          actionCell.querySelector(".cancelBtn").onclick = () => cancelEdit(row);
        };
      });
    }

    function saveEdit(row) {
      const id = parseInt(row.children[0].textContent);
      const name = row.children[1].querySelector("input,select").value.trim();
      const role = row.children[2].querySelector("input,select").value.trim();
      const email = row.children[3].querySelector("input,select").value.trim();

      if (!name || !role || !email) {
        alert("All fields are required.");
        return;
      }
      // Simple email validation
      if (!email.includes("@")) {
        alert("Please enter a valid email.");
        return;
      }

      const profile = profiles.find(p => p.id === id);
      profile.name = name;
      profile.role = role;
      profile.email = email;

      row.classList.remove("editing");
      renderProfiles();
    }

    function cancelEdit(row) {
      row.classList.remove("editing");
      renderProfiles();
    }

    profileForm.addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const role = document.getElementById("role").value;
      const email = document.getElementById("email").value.trim();

      if (!name || !role || !email) {
        alert("Please fill all fields.");
        return;
      }
      if (!email.includes("@")) {
        alert("Please enter a valid email.");
        return;
      }

      const newProfile = {
        id: profiles.length ? profiles[profiles.length - 1].id + 1 : 1,
        name,
        role,
        email
      };

      profiles.push(newProfile);
      renderProfiles();
      profileForm.reset();
    });

    searchInput.addEventListener("input", renderProfiles);

    // Sorting
    document.querySelectorAll("#profilesTable th[data-key]").forEach(th => {
      th.addEventListener("click", () => {
        const key = th.getAttribute("data-key");
        if (sortKey === key) {
          sortAsc = !sortAsc;
        } else {
          sortKey = key;
          sortAsc = true;
        }
        renderProfiles();
      });
    });

    // Delete modal buttons
    confirmDeleteBtn.onclick = () => {
      profiles = profiles.filter(p => p.id !== deleteId);
      deleteId = null;
      deleteModal.style.display = "none";
      renderProfiles();
    };
    cancelDeleteBtn.onclick = () => {
      deleteId = null;
      deleteModal.style.display = "none";
    };

    // Close modal on outside click or Escape key
    deleteModal.onclick = e => {
      if (e.target === deleteModal) {
        deleteId = null;
        deleteModal.style.display = "none";
      }
    };
    window.addEventListener("keydown", e => {
      if (e.key === "Escape" && deleteModal.style.display === "flex") {
        deleteId = null;
        deleteModal.style.display = "none";
      }
    });

    renderProfiles();
  </script>
</body>
</html>